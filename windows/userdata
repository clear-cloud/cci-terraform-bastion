<powershell>
$ErrorActionPreference = "Stop"
#
# Install custom additional set-up PRE
#
${supplementary_user_data_pre}
# Install AWSCLI
$uri = "https://s3.amazonaws.com/aws-cli/AWSCLI32PY3.msi"
$out = "c:\AWSCLI32PY3.msi"
Invoke-WebRequest -uri $uri -OutFile $out
Start-Process -FilePath "msiexec.exe" -ArgumentList "/i $out /quiet /norestart /l c:\AWSCLI32PY3.msi.log.txt"
#Disable windows firewall on all profiles
Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False -ErrorAction Stop

# Change username
Rename-LocalUser -Name "Administrator" -NewName ${userName}

# Change admin password
$adminPassword = Get-SSMParameter -Name ${ComputerName} -WithDecryption $TRUE
$Admin = [adsi]("WinNT://$env:ComputerName/${userName}, user")
$Admin.Invoke("SetPassword", $adminPassword.value)


#
# Install custom additional set-up POST
#
${supplementary_user_data}
Restart-Computer
</powershell>
